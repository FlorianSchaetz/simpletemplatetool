"use strict";var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var ExpressionFinder=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"getExpressions",value:function getExpressions(b){var c=b.match(/«(.|\r|\n)+?»/g);return void 0!=c&&null!=c?c:[]}}]),a}(),VariableFactory=function(){function a(){_classCallCheck(this,a),this.autoVariables={},this.autoVariables.currentyear=function(){return""+new Date().getFullYear()}}return _createClass(a,[{key:"createVariables",value:function createVariables(b){for(var c={},d=[],e=0;e<b.length;e++)!0!=c[b[e]]&&(c[b[e]]=!0,d.push(this.createVariable(b[e])));return d}},{key:"createVariable",value:function createVariable(b){var c=b.substring(1,b.length-1),d=this.autoVariables[c];return void 0!=d&&null!=d?new AutoVariable(b,d()):c.startsWith("textarea:")?new TextareaVariable(b):c.startsWith("boolean:")?new BooleanVariable(b):new Variable(b)}}]),a}(),Variable=function(){function a(b){_classCallCheck(this,a),this.expression=b,this.name=this.expression.substring(1,this.expression.length-1)}return _createClass(a,[{key:"isEnterable",value:function isEnterable(){return!0}},{key:"createInput",value:function createInput(){return this.input=document.createElement("input"),this.input.variable=this,this.input.oninput=this.onInputInternal,this.input}},{key:"setOnInput",value:function setOnInput(b){this.oninput=b}},{key:"onInputInternal",value:function onInputInternal(){this.variable.content=this.variable.input.value,this.variable.oninput(),this.focus()}},{key:"getName",value:function getName(){return this.name}},{key:"getContent",value:function getContent(){return null!=this.content&&0<this.content.length?this.content:"\xAB"+this.getName()+"\xBB"}},{key:"getSpanClassName",value:function getSpanClassName(){return null}}]),a}(),AutoVariable=function(a){function b(c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));return e.content=d,e}return _inherits(b,a),_createClass(b,[{key:"isEnterable",value:function isEnterable(){return!1}},{key:"createInput",value:function createInput(){return null}}]),b}(Variable),TextareaVariable=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));return d.name=d.expression.substring("\xABtextarea:".length,d.expression.length-1),d}return _inherits(b,a),_createClass(b,[{key:"createInput",value:function createInput(){return this.input=document.createElement("textarea"),this.input.variable=this,this.input.oninput=this.onInputInternal,this.input}}]),b}(Variable),BooleanVariable=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c)),e=d.expression.indexOf(":"),f=d.expression.indexOf(":",e+1);return d.name=d.expression.substring(e+1,f),d.value=d.expression.substring(f+1,d.expression.length-1),d}return _inherits(b,a),_createClass(b,[{key:"getContent",value:function getContent(){return this.input.checked?this.content:""}},{key:"createInput",value:function createInput(){return this.input=document.createElement("input"),this.input.type="checkbox",this.input.value=this.value,this.input.variable=this,this.input.onchange=this.onInputInternal,this.input}},{key:"getSpanClassName",value:function getSpanClassName(){return"checkbox-span"}}]),b}(Variable),VariableHandler=function(){function a(b){_classCallCheck(this,a),this.variables=[],this.input=b,this.factory=new VariableFactory}return _createClass(a,[{key:"setText",value:function setText(b){this.input.original=b;var c=new ExpressionFinder().getExpressions(b);this.variables=this.factory.createVariables(c);for(var e,d=document.getElementById("variables");d.hasChildNodes();)e=d.lastChild,d.removeChild(e);for(var f=0;f<this.variables.length;f++)if(this.variables[f].isEnterable()){var e=document.createElement("div"),g=document.createElement("span");g.innerHTML=this.variables[f].getName(),null!=this.variables[f].getSpanClassName()&&(g.className=this.variables[f].getSpanClassName()),e.appendChild(g),e.appendChild(this.variables[f].createInput());var h=this;this.variables[f].setOnInput(function(){h.update()}),d.appendChild(e)}this.update()}},{key:"replaceAll",value:function replaceAll(b){for(var c=b,d=0;d<this.variables.length;d++){var e=this.variables[d].expression,f=this.variables[d].getContent();c=c.split(e).join(f)}return c}},{key:"update",value:function update(){var b=this.input.original;this.input.value=this.replaceAll(b),this.selectAndCopy()}},{key:"selectAndCopy",value:function selectAndCopy(){this.input.select();try{var b=document.execCommand("copy");b&&(this.input.selectionStart=-1,this.input.selectionEnd=-1)}catch(c){console.log("Oops, unable to copy")}}}]),a}(),InputHandler=function(){function a(b,c){_classCallCheck(this,a),this.shortcut=document.getElementById("shortcut"),this.search=document.getElementById("search"),this.dataHandler=b,this.search.inputHandler=this,this.search.oninput=this.onSearchInput,this.variableHandler=c,this.selectCategories=document.getElementById("categories"),this.selectCategories.inputHandler=this,this.selectCategories.onchange=this.onCategoryChanged,this.selectTemplates=document.getElementById("templates"),this.selectTemplates.inputHandler=this,this.selectTemplates.onchange=this.onTemplateChanged,this.setCategories(),this.selectCategories.onchange(),this.selectTemplates.onchange(),this.initAutoComplete()}return _createClass(a,[{key:"initAutoComplete",value:function initAutoComplete(){for(var b=[],c=0;c<data.length;c++)null!=data[c].shortcut&&void 0!=data[c].shortcut&&0<data[c].shortcut.length&&b.push(data[c].shortcut);var d=new Awesomplete(this.search);d.list=b,this.search.addEventListener("awesomplete-selectcomplete",this.onSearchInput)}},{key:"onSearchInput",value:function onSearchInput(){for(var b=this.value,c=0;c<data.length;c++)data[c].shortcut===b&&(this.inputHandler.selectCategories.value=data[c].category,this.inputHandler.selectCategories.onchange(),this.inputHandler.selectTemplates.value=data[c].template,this.inputHandler.selectTemplates.onchange());this.focus()}},{key:"setCategories",value:function setCategories(){for(var d,b=this.dataHandler.getCategories(),c=0;c<b.length;c++)d=document.createElement("option"),d.value=b[c],d.textContent=b[c],this.selectCategories.appendChild(d)}},{key:"getSelectedCategory",value:function getSelectedCategory(){return-1==this.selectCategories.selectedIndex?null:this.selectCategories.options[this.selectCategories.selectedIndex].value}},{key:"getSelectedTemplate",value:function getSelectedTemplate(){return-1==this.selectTemplates.selectedIndex?null:this.selectTemplates.options[this.selectTemplates.selectedIndex].value}},{key:"onCategoryChanged",value:function onCategoryChanged(){var b=this.inputHandler.getSelectedCategory();this.inputHandler.setTemplates(b)}},{key:"onTemplateChanged",value:function onTemplateChanged(){var b=this.inputHandler.getSelectedCategory(),c=this.inputHandler.getSelectedTemplate(),d=this.inputHandler.dataHandler.getTemplate(b,c);this.inputHandler.variableHandler.setText(d.content),this.inputHandler.shortcut.value=d.shortcut}},{key:"setTemplates",value:function setTemplates(b){for(;0<this.selectTemplates.options.length;)this.selectTemplates.remove(0);for(var e,c=this.dataHandler.getTemplates(b),d=0;d<c.length;d++)e=document.createElement("option"),e.value=c[d],e.textContent=c[d],this.selectTemplates.appendChild(e);this.selectTemplates.onchange()}}]),a}(),DirectDataProvider=function(){function a(b){_classCallCheck(this,a),this.data=b}return _createClass(a,[{key:"getCategories",value:function getCategories(){for(var b={},c=0;c<this.data.length;c++)b[this.data[c].category]=1;var d=[];for(var e in b)d.push(e);return d}},{key:"getTemplates",value:function getTemplates(b){for(var c={},d=0;d<this.data.length;d++)this.data[d].category==b&&(c[this.data[d].template]=1);var e=[];for(var f in c)e.push(f);return e}},{key:"getTemplate",value:function getTemplate(b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].category==b&&this.data[d].template==c)return this.data[d];return null}}]),a}();function fixIE(){String.prototype.startsWith||(String.prototype.startsWith=function(a,b){return b=b||0,this.indexOf(a,b)===b})}function init(){fixIE();var a=new VariableHandler(document.getElementById("text")),b=new DirectDataProvider(data),c=new InputHandler(b,a)}