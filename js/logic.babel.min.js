"use strict";var _createClass=function(){function a(b,c){for(var f,e=0;e<c.length;e++)f=c[e],f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,e){return c&&a(b.prototype,c),e&&a(b,e),b}}();function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var ExpressionFinder=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"getExpressions",value:function getExpressions(b){var c=b.match(/«(.|\r|\n)+?»/g);return void 0!=c&&null!=c?c:[]}}]),a}(),VariableFactory=function(){function a(){_classCallCheck(this,a),this.autoVariables={},this.autoVariables.currentyear=function(){return""+new Date().getFullYear()}}return _createClass(a,[{key:"createVariables",value:function createVariables(b){for(var g,c={},e=[],f=0;f<b.length;f++)g=this.createVariable(b[f]),void 0==c[g.getName()]?(c[g.getName()]=g,e.push(g)):(g=c[g.getName()].handleDuplicate(g),null!=g&&e.push(g));return e}},{key:"createVariable",value:function createVariable(b){var c=b.substring(1,b.length-1),e=this.autoVariables[c];return void 0!=e&&null!=e?new AutoVariable(b,e()):c.startsWith("textarea:")?new TextareaVariable(b):c.startsWith("boolean:")?new BooleanVariable(b):new Variable(b)}}]),a}(),Variable=function(){function a(b){_classCallCheck(this,a),this.expression=b,this.name=this.expression.substring(1,this.expression.length-1),this.type="Variable"}return _createClass(a,[{key:"isEnterable",value:function isEnterable(){return!0}},{key:"createInput",value:function createInput(){return this.input=document.createElement("input"),this.input.variable=this,this.input.oninput=this.onInputInternal,this.input}},{key:"setOnInput",value:function setOnInput(b){this.oninput=b}},{key:"onInputInternal",value:function onInputInternal(){this.variable.content=this.variable.input.value,this.variable.oninput(),this.focus()}},{key:"getName",value:function getName(){return this.name}},{key:"getContent",value:function getContent(){return null!=this.content&&0<this.content.length?this.content:"\xAB"+this.getName()+"\xBB"}},{key:"getSpanClassName",value:function getSpanClassName(){return null}},{key:"handleDuplicate",value:function handleDuplicate(){return null}}]),a}(),AutoVariable=function(a){function b(c,e){_classCallCheck(this,b);var f=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));return f.content=e,f.type="AutoVariable",f}return _inherits(b,a),_createClass(b,[{key:"isEnterable",value:function isEnterable(){return!1}},{key:"createInput",value:function createInput(){return null}}]),b}(Variable),TextareaVariable=function(a){function b(c){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));return e.name=e.expression.substring("\xABtextarea:".length,e.expression.length-1),e.type="TextareaVariable",e}return _inherits(b,a),_createClass(b,[{key:"createInput",value:function createInput(){return this.input=document.createElement("textarea"),this.input.variable=this,this.input.oninput=this.onInputInternal,this.input}}]),b}(Variable),BooleanVariable=function(a){function b(c){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));e.type="BooleanVariable";var f=e.expression.indexOf(":"),g=e.expression.indexOf(":",f+1);return e.name=e.expression.substring(f+1,g),e.value=e.expression.substring(g+1,e.expression.length-1),e}return _inherits(b,a),_createClass(b,[{key:"getContent",value:function getContent(){return this.input.checked?this.content:""}},{key:"createInput",value:function createInput(){return this.input=document.createElement("input"),this.input.type="checkbox",this.input.value=this.value,this.input.variable=this,this.input.onchange=this.onInputInternal,this.input}},{key:"getSpanClassName",value:function getSpanClassName(){return"checkbox-span"}},{key:"handleDuplicate",value:function handleDuplicate(c){var e=new AdditionalBooleanVariable(c.expression);return e.setParentBoolean(this),e}}]),b}(Variable),AdditionalBooleanVariable=function(a){function b(c){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));e.type="BooleanVariable";var f=e.expression.indexOf(":"),g=e.expression.indexOf(":",f+1);return e.name=e.expression.substring(f+1,g),e.content=e.expression.substring(g+1,e.expression.length-1),e}return _inherits(b,a),_createClass(b,[{key:"setParentBoolean",value:function setParentBoolean(c){this.parent=c}},{key:"getContent",value:function getContent(){return this.parent.input.checked?this.content:""}},{key:"isEnterable",value:function isEnterable(){return!1}},{key:"createInput",value:function createInput(){return null}}]),b}(Variable),VariableHandler=function(){function a(b){_classCallCheck(this,a),this.variables=[],this.input=b,this.factory=new VariableFactory}return _createClass(a,[{key:"setText",value:function setText(b){this.input.original=b;var c=new ExpressionFinder().getExpressions(b);this.variables=this.factory.createVariables(c);for(var f,e=document.getElementById("variables");e.hasChildNodes();)f=e.lastChild,e.removeChild(f);for(var g=0;g<this.variables.length;g++)if(this.variables[g].isEnterable()){var f=document.createElement("div"),h=document.createElement("span");h.innerHTML=this.variables[g].getName(),null!=this.variables[g].getSpanClassName()&&(h.className=this.variables[g].getSpanClassName()),f.appendChild(h),f.appendChild(this.variables[g].createInput());var j=this;this.variables[g].setOnInput(function(){j.update()}),e.appendChild(f)}this.update()}},{key:"replaceAll",value:function replaceAll(b){for(var c=b,e=0;e<this.variables.length;e++){var f=this.variables[e].expression,g=this.variables[e].getContent();c=c.split(f).join(g)}return c}},{key:"update",value:function update(){var b=this.input.original;this.input.value=this.replaceAll(b),this.selectAndCopy()}},{key:"selectAndCopy",value:function selectAndCopy(){this.input.select();var b=!!window.MSInputMethodContext&&!!document.documentMode;b?setTimeout(this.copy,0):this.copy()}},{key:"copy",value:function copy(){try{var b=document.execCommand("copy");b?(this.input.selectionStart=-1,this.input.selectionEnd=-1):console.log("Oops, Copy failed, sorry about that.")}catch(c){console.log("Oops, unable to copy, sorry about that.")}}}]),a}(),InputHandler=function(){function a(b,c){_classCallCheck(this,a),this.shortcut=document.getElementById("shortcut"),this.search=document.getElementById("search"),this.dataHandler=b,this.search.inputHandler=this,this.search.oninput=this.onSearchInput,this.variableHandler=c,this.selectCategories=document.getElementById("categories"),this.selectCategories.inputHandler=this,this.selectCategories.onchange=this.onCategoryChanged,this.selectTemplates=document.getElementById("templates"),this.selectTemplates.inputHandler=this,this.selectTemplates.onchange=this.onTemplateChanged,this.setCategories(),this.selectCategories.onchange(),this.selectTemplates.onchange(),this.initAutoComplete()}return _createClass(a,[{key:"initAutoComplete",value:function initAutoComplete(){for(var b=[],c=0;c<data.length;c++)null!=data[c].shortcut&&void 0!=data[c].shortcut&&0<data[c].shortcut.length&&b.push(data[c].shortcut);var e=new Awesomplete(this.search);e.list=b,this.search.addEventListener("awesomplete-selectcomplete",this.onSearchInput)}},{key:"onSearchInput",value:function onSearchInput(){for(var b=this.value,c=0;c<data.length;c++)data[c].shortcut===b&&(this.inputHandler.selectCategories.value=data[c].category,this.inputHandler.selectCategories.onchange(),this.inputHandler.selectTemplates.value=data[c].template,this.inputHandler.selectTemplates.onchange());this.focus()}},{key:"setCategories",value:function setCategories(){for(var e,b=this.dataHandler.getCategories(),c=0;c<b.length;c++)e=document.createElement("option"),e.value=b[c],e.textContent=b[c],this.selectCategories.appendChild(e)}},{key:"getSelectedCategory",value:function getSelectedCategory(){return-1==this.selectCategories.selectedIndex?null:this.selectCategories.options[this.selectCategories.selectedIndex].value}},{key:"getSelectedTemplate",value:function getSelectedTemplate(){return-1==this.selectTemplates.selectedIndex?null:this.selectTemplates.options[this.selectTemplates.selectedIndex].value}},{key:"onCategoryChanged",value:function onCategoryChanged(){var b=this.inputHandler.getSelectedCategory();this.inputHandler.setTemplates(b)}},{key:"onTemplateChanged",value:function onTemplateChanged(){var b=this.inputHandler.getSelectedCategory(),c=this.inputHandler.getSelectedTemplate(),e=this.inputHandler.dataHandler.getTemplate(b,c);this.inputHandler.variableHandler.setText(e.content),this.inputHandler.shortcut.value=e.shortcut}},{key:"setTemplates",value:function setTemplates(b){for(;0<this.selectTemplates.options.length;)this.selectTemplates.remove(0);for(var f,c=this.dataHandler.getTemplates(b),e=0;e<c.length;e++)f=document.createElement("option"),f.value=c[e],f.textContent=c[e],this.selectTemplates.appendChild(f);this.selectTemplates.onchange()}}]),a}(),DirectDataProvider=function(){function a(b){_classCallCheck(this,a),this.data=b,this.map={};for(var c=0;c<this.data.length;c++){var e=b[c],f=e.category,g=e.template;this.map[f+":"+g]=e.content}}return _createClass(a,[{key:"getCategories",value:function getCategories(){for(var b={},c=0;c<this.data.length;c++)b[this.data[c].category]=1;var e=[];for(var f in b)e.push(f);return e}},{key:"getTemplates",value:function getTemplates(b){for(var c={},e=0;e<this.data.length;e++)this.data[e].category==b&&(c[this.data[e].template]=1);var f=[];for(var g in c)f.push(g);return f}},{key:"getTemplate",value:function getTemplate(b,c){for(var e=0;e<this.data.length;e++)if(this.data[e].category==b&&this.data[e].template==c)return console.timeEnd("someFunction"),this.data[e];return null}}]),a}();function fixIE(){String.prototype.startsWith||(String.prototype.startsWith=function(a,b){return b=b||0,this.indexOf(a,b)===b})}function init(){fixIE();var a=new VariableHandler(document.getElementById("text")),b=new DirectDataProvider(data),c=new InputHandler(b,a)}